<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Diagnosis Record</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @page {
      size: A4;
      margin: 2px 20px;
    }

    table,
    tr,
    td,
    th {
      page-break-inside: avoid !important;
    }
  </style>
</head>

<body class="text-gray-800 text-sm leading-relaxed bg-white">
  <div class="max-w-4xl mx-auto p-5">
    {{#unless isPrinting}}
    <div class="bg-gradient-to-r from-blue-900 to-blue-500 text-white p-5 rounded-t-lg mb-6">
      <div class="flex justify-between items-center gap-5">
        <div class="shrink-0">
          {{#if logoUrl}}
          <img src="{{logoUrl}}" alt="Hospital Logo" class="h-20 object-contain" />
          {{/if}}
        </div>
        <div class="text-right text-base">
          {{#if hospital.name}}
          <div class="text-xl font-bold mb-2">{{hospital.name}}</div>
          {{/if}}
          {{#if hospital.address}}
          <div>{{hospital.address}}</div>
          {{/if}}
          {{#if hospital.phone}}
          <div>Phone: {{hospital.phone}}</div>
          {{/if}}
        </div>
      </div>
    </div>
    {{/unless}}

    <div class="grid grid-cols-2 gap-6 bg-gray-50 p-5 rounded-lg mb-6">
      <div>
        <div class="mb-1 font-semibold text-gray-700">Patient Name: <span class="font-normal text-gray-900">{{patient.name}}</span></div>
        <div class="mb-1 font-semibold text-gray-700">Phone: <span class="font-normal text-gray-900">{{patient.phone}}</span></div>
        <div class="mb-1 font-semibold text-gray-700">Patient ID: <span class="font-normal text-gray-900">{{patient.uhid}}</span></div>
        <div class="mb-1 font-semibold text-gray-700">Gender: <span class="font-normal text-gray-900">{{patient.gender}}</span></div>
      </div>
      <div>
        <div class="mb-1 font-semibold text-gray-700">Registration Mode: <span class="font-normal text-gray-900">{{patient.registrationMode}}</span></div>
        <div class="mb-1 font-semibold text-gray-700">Registration Source: <span class="font-normal text-gray-900">{{patient.registrationSource}}</span></div>
        <div class="mb-1 font-semibold text-gray-700">Status: <span class="font-normal text-gray-900">{{patient.status}}</span></div>
        <div class="mb-1 font-semibold text-gray-700">Age: <span class="font-normal text-gray-900">{{patient.age}} years</span></div>
      </div>
    </div>

    <h2 class="text-blue-800 font-bold text-base border-b border-gray-200 pb-1 mb-4">Prescribed Medicines</h2>
    {{#if medicines.length}}
    <table class="w-full text-xs mb-6 border border-gray-200">
      <thead class="bg-gray-100 font-bold">
        <tr>
          <th class="p-1 text-left">S.No</th>
          <th class="p-1 text-left">Medicine Name</th>
          <th class="p-1 text-left">Frequency</th>
          <th class="p-1 text-left">Duration (Days)</th>
        </tr>
      </thead>
      <tbody>
        {{#each medicines}}
        <tr class="odd:bg-gray-50">
          <td class="p-1">{{inc @index}}</td>
          <td class="p-1 font-semibold text-gray-900">{{name}}</td>
          <td class="p-1">{{frequency}}</td>
          <td class="p-1">{{duration}}</td>
        </tr>
        {{/each}}
      </tbody>
    </table>
    {{else}}
    <div class="text-center p-6 italic text-gray-500 bg-gray-50 rounded">No medicines prescribed</div>
    {{/if}}

    {{#if labTests.length}}
    <h2 class="text-blue-800 font-bold text-base border-b border-gray-200 pb-1 mb-4">Lab Tests</h2>
    <table class="w-full text-xs mb-6 border border-gray-200">
      <thead class="bg-gray-100 font-bold">
        <tr>
          <th class="p-1 text-left">Test Name</th>
          <th class="p-1 text-left">Status</th>
          <th class="p-1 text-left">Report Date</th>
        </tr>
      </thead>
      <tbody>
        {{#each labTests}}
        <tr class="odd:bg-gray-50">
          <td class="p-1">{{labTest.name}}</td>
          <td class="p-1">
            <span class="text-[10px] font-bold uppercase px-2 py-1 rounded
              {{#if (eq status 'COMPLETED')}}bg-green-100 text-green-700{{/if}}
              {{#if (eq status 'PENDING')}}bg-yellow-100 text-yellow-700{{/if}}
              {{#if (eq status 'PROCESSING')}}bg-blue-100 text-blue-700{{/if}}">
              {{status}}
            </span>
          </td>
          <td class="p-1">
            {{#if tentativeReportDate}}
            {{formatDate tentativeReportDate}}
            {{else}}
            Not Updated
            {{/if}}
          </td>
        </tr>
        {{/each}}
      </tbody>
    </table>
    {{/if}}

    <div class="grid grid-cols-2 gap-6 bg-gray-100 p-5 rounded-lg mb-6">
      <div class="flex gap-3">
        <span class="font-semibold text-gray-700 min-w-[120px]">Follow-ups:</span>
        <span>
          {{#if followUpAppointment}}
          {{formatDateTimeUTC followUpAppointment.scheduledAt}}
          {{#if followUpAppointment.doctor}}
          with Dr. {{followUpAppointment.doctor.name}}
          {{#if followUpAppointment.doctor.specialisation}}
          ({{followUpAppointment.doctor.specialisation}})
          {{/if}}
          {{/if}}
          {{else}}
          No Follow-Up Required
          {{/if}}
        </span>
      </div>
      <div class="flex gap-3">
        <span class="font-semibold text-gray-700 min-w-[120px]">Surgical Status:</span>
        <span>
          {{#if surgicalInfo}}
          {{#if (ne surgicalInfo.status 'NOT_REQUIRED')}}
          {{#if (eq surgicalInfo.status 'CONFIRMED')}}
          Confirmed{{#if surgicalInfo.category}} - {{surgicalInfo.category}}{{/if}}{{#if surgicalInfo.scheduledAt}} - {{formatDate surgicalInfo.scheduledAt}}{{/if}}
          {{else}}
          Pending{{#if surgicalInfo.category}} - {{surgicalInfo.category}}{{/if}}{{#if surgicalInfo.scheduledAt}} - {{formatDate surgicalInfo.scheduledAt}}{{/if}}
          {{/if}}
          {{else}}
          Non-Surgical Treatment
          {{/if}}
          {{else}}
          Non-Surgical Treatment
          {{/if}}
        </span>
      </div>
    </div>

    {{#if notes}}
    <div class="bg-yellow-50 border border-yellow-300 p-5 rounded-lg mb-6">
      <div class="text-yellow-800 font-bold mb-2 text-sm">Clinical Notes</div>
      <div class="text-yellow-900 text-sm leading-relaxed">{{notes}}</div>
    </div>
    {{/if}}

    {{#unless isPrinting}}
    <div class="mt-8 pt-4 border-t border-gray-200 bg-gray-50 -mx-5 px-5 pb-5">
      <div class="flex justify-between text-gray-500 text-xs">
        <div>
          <div>Created on: {{formatDateTime createdAt}}</div>
          <div>Doctor: {{doctor.name}}</div>
        </div>
        <div class="text-right">
          <div>Authorized Sign</div>
          <div class="border-t border-gray-400 w-40 mt-2"></div>
        </div>
      </div>
    </div>
    {{/unless}}
  </div>
</body>

</html>